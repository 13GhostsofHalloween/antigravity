<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeccoCRO Logo Particle Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #ffffff;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas {
            display: block;
            cursor: pointer;
        }

        .info {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #495057;
            font-size: 14px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 24px;
            border-radius: 50px;
            border: 2px solid #667eea;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
        }

        .info h2 {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 8px;
        }

        .controls {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 10;
        }

        .controls button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .controls button.active {
            background: linear-gradient(135deg, #764ba2, #667eea);
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <button id="btn-scatter">Scatter</button>
        <button id="btn-form" class="active">Form Logo</button>
        <button id="btn-explode">Explode</button>
    </div>

    <div class="info">
        <h2>BeccoCRO Logo Particle Animation</h2>
        <p>Click to interact • 5,000 particles forming the logo</p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        const particleCount = 5000;
        const particles = [];
        let logoPixels = [];
        let isFormed = true;
        let mouseX = width / 2;
        let mouseY = height / 2;

        class Particle {
            constructor(index) {
                this.index = index;
                this.reset();
                this.targetX = 0;
                this.targetY = 0;
                this.hasTarget = false;
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = 1 + Math.random() * 2;
                this.opacity = 0.3 + Math.random() * 0.7;

                // 색상: 보라색 계열
                const hue = 250 + Math.random() * 30;
                const sat = 60 + Math.random() * 20;
                const light = 40 + Math.random() * 20;
                this.color = `hsl(${hue}, ${sat}%, ${light}%)`;
            }

            setTarget(x, y) {
                this.targetX = x;
                this.targetY = y;
                this.hasTarget = true;
            }

            update() {
                if (isFormed && this.hasTarget) {
                    // 로고 형성 모드
                    const dx = this.targetX - this.x;
                    const dy = this.targetY - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist > 1) {
                        this.vx = dx * 0.05;
                        this.vy = dy * 0.05;
                    } else {
                        this.vx *= 0.95;
                        this.vy *= 0.95;
                    }
                } else {
                    // 자유 이동 모드
                    this.vx += (Math.random() - 0.5) * 0.2;
                    this.vy += (Math.random() - 0.5) * 0.2;

                    // 속도 제한
                    const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                    if (speed > 3) {
                        this.vx = (this.vx / speed) * 3;
                        this.vy = (this.vy / speed) * 3;
                    }
                }

                this.x += this.vx;
                this.y += this.vy;

                // 마우스 반발력
                const mdx = this.x - mouseX;
                const mdy = this.y - mouseY;
                const mdist = Math.sqrt(mdx * mdx + mdy * mdy);
                if (mdist < 100) {
                    const force = (100 - mdist) / 100;
                    this.vx += (mdx / mdist) * force * 2;
                    this.vy += (mdy / mdist) * force * 2;
                }

                // 경계 처리
                if (this.x < 0 || this.x > width) this.vx *= -0.5;
                if (this.y < 0 || this.y > height) this.vy *= -0.5;
                this.x = Math.max(0, Math.min(width, this.x));
                this.y = Math.max(0, Math.min(height, this.y));
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.opacity;
                ctx.fill();

                // 빛나는 효과
                if (isFormed && this.hasTarget) {
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = this.color;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
        }

        // 이미지 로드 및 픽셀 샘플링
        function loadLogo() {
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.onload = function () {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');

                // 로고 크기 조정 (화면의 40% 정도)
                const scale = Math.min(width, height) * 0.4 / Math.max(img.width, img.height);
                const logoWidth = img.width * scale;
                const logoHeight = img.height * scale;

                tempCanvas.width = logoWidth;
                tempCanvas.height = logoHeight;

                tempCtx.drawImage(img, 0, 0, logoWidth, logoHeight);
                const imageData = tempCtx.getImageData(0, 0, logoWidth, logoHeight);
                const pixels = imageData.data;

                // 픽셀 샘플링 (알파값이 있는 픽셀만)
                logoPixels = [];
                const step = 2; // 샘플링 간격

                for (let y = 0; y < logoHeight; y += step) {
                    for (let x = 0; x < logoWidth; x += step) {
                        const index = (y * logoWidth + x) * 4;
                        const alpha = pixels[index + 3];

                        if (alpha > 50) { // 반투명 이상인 픽셀만
                            logoPixels.push({
                                x: x - logoWidth / 2 + width / 2,
                                y: y - logoHeight / 2 + height / 2
                            });
                        }
                    }
                }

                console.log(`Logo pixels sampled: ${logoPixels.length}`);
                assignTargets();
            };

            img.onerror = function () {
                console.error('Failed to load image. Using fallback circle pattern.');
                createFallbackPattern();
            };

            img.src = 'img/becco_small.png';
        }

        // 이미지 로드 실패 시 대체 패턴
        function createFallbackPattern() {
            logoPixels = [];
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) * 0.2;

            for (let angle = 0; angle < Math.PI * 2; angle += 0.05) {
                for (let r = 0; r < radius; r += 5) {
                    logoPixels.push({
                        x: centerX + Math.cos(angle) * r,
                        y: centerY + Math.sin(angle) * r
                    });
                }
            }

            assignTargets();
        }

        // 파티클에 타겟 할당
        function assignTargets() {
            if (logoPixels.length === 0) return;

            for (let i = 0; i < particles.length; i++) {
                const pixel = logoPixels[i % logoPixels.length];
                particles[i].setTarget(pixel.x, pixel.y);
            }
        }

        // 파티클 초기화
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle(i));
        }

        // 애니메이션 루프
        function animate() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(0, 0, width, height);

            for (const particle of particles) {
                particle.update();
                particle.draw();
            }

            requestAnimationFrame(animate);
        }

        // 이벤트 리스너
        canvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        canvas.addEventListener('click', () => {
            isFormed = !isFormed;
        });

        document.getElementById('btn-scatter').addEventListener('click', () => {
            isFormed = false;
            document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-scatter').classList.add('active');
        });

        document.getElementById('btn-form').addEventListener('click', () => {
            isFormed = true;
            document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-form').classList.add('active');
        });

        document.getElementById('btn-explode').addEventListener('click', () => {
            particles.forEach(p => {
                const angle = Math.random() * Math.PI * 2;
                const force = 5 + Math.random() * 10;
                p.vx = Math.cos(angle) * force;
                p.vy = Math.sin(angle) * force;
            });
        });

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            loadLogo(); // 리사이즈 시 로고 재로드
        });

        // 시작
        loadLogo();
        animate();
    </script>
</body>

</html>